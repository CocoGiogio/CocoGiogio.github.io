<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gallery - W4RSH3LL</title>

    <!-- Styles -->
    <link rel="stylesheet" href="../../../css/style.css" />
    <link rel="stylesheet" href="../../../css/write_up.css" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../../../assets/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="../../../assets/favicon.svg" />
    <link rel="shortcut icon" href="../../../assets/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="../../../assets/apple-touch-icon.png" />
    <link rel="manifest" href="../../../assets/site.webmanifest" />
</head>

<body>

    <!-- Background -->
    <div class="background-overlay"></div>
    <div class="particles"></div>

    <!-- Navigation -->
    <nav>
        <div class="logo-container">
            <img src="../../../assets/leviathan_profil_pic.jpg" alt="W4RSH3LL Avatar" class="avatar" />
            <span class="logo-text">W4RSH3LL</span>
            <button class="menu-toggle" aria-label="Toggle menu">&#9776;</button>
        </div>

        <ul class="menu">
          <li><a href="../../../index.html">Home</a></li>
          <li><a href="../../../html/about.html">About</a></li>
          <li><a href="../../../html/projects.html">Projects</a></li>
          <li><a href="../../../html/certifications.html">Certifications</a></li>
          <li><a href="../../../html/documentations.html">Documentations</a></li>
          <li><a href="../../../html/write-ups.html" class="active">Write-ups</a></li>
          <li><a href="../../../html/skills.html">Skills</a></li>
      </ul>
    </nav>

    <!-- Main Content -->
    <main>
        <section class="report-section">

            <h1 class="section-title">Gallery - Write-up</h1>
            <img src="../gallery/assets/logo.png">

            <!-- Overview -->
            <h2>Machine Overview</h2>
            <ul>
                <li><strong>Title:</strong> Gallery</li>
                <li><strong>Description:</strong> Try to exploit our image gallery system.</li>
                <li><strong>Target IP:</strong> 10.10.171.189</li>
                <li><strong>Difficulty:</strong> Easy</li>
            </ul>
            <hr>

            <h2>Important Notes</h2>
            <ul>
                <li><strong>SQL Payload:</strong> <pre><code>admin' or 1=1#</code></pre></li>
                <li><strong>Unsecured file upload</strong></li>
                <li><strong>Creds from initialize.php:</strong> gallery_user:passw0rd321</li>
                <li><strong>GalleryDB name:</strong> gallery_db</li>
                <li><strong>Hash password of the admin user:</strong> a228b12a08b6527e7978cbe5d914531c</li>
                <li><strong>Mike's password (found in backup of his .bash_history):</strong> b3stpassw0rdbr0xx</li>
            </ul>
            <hr>

            <h2>Questions to answer</h2>
            <ul>
                <li><strong>Question 1:</strong> How many ports are open:</li>
                <li><strong>Answer:</strong> 3</li>
                <br>
                <li><strong>Question 2:</strong> What is the name of the CMS::</li>
                <li><strong>Answer:</strong> Simple Image Gallery</li>
                <br>
                <li><strong>Question 3:</strong> What's the hash password the admin user:</li>
                <li><strong>Answer:</strong> a228b12a08b6527e7978cbe5d914531c</li>
                <br>
                <li><strong>Question 4:</strong> What's the user's flag:</li>
                <li><strong>Answer:</strong> (See Screenshot)</li>
                <br>
            </ul>

            <!-- Nmap -->
            <h2>Nmap Port Scan</h2>

<h3>Scan 1:</h3>
<pre><code>nmap 10.10.171.189</code></pre>

<table border="1" cellpadding="6" cellspacing="0">
  <thead>
    <tr>
      <th>Ports</th>
      <th>State</th>
      <th>Service</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>22/tcp</td>
      <td>Open</td>
      <td>ssh</td>
    </tr>
    <tr>
      <td>80/tcp</td>
      <td>Open</td>
      <td>http</td>
    </tr>
    <tr>
      <td>8080</td>
      <td>Open</td>
      <td>http-proxy</td>
    </tr>
  </tbody>
</table>

<h3>Scan 2:</h3>
<pre><code>nmap -A 10.10.171.189</code></pre>

<table border="1" cellpadding="6" cellspacing="0">
  <thead>
    <tr>
      <th>Ports</th>
      <th>State</th>
      <th>Service</th>
      <th>Version</th>
      <th>Details</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>22/tcp</td>
      <td>Open</td>
      <td>ssh</td>
      <td>OpenSSH 8.2p1 Ubuntu 4ubuntu0.13 (Ubuntu Linux; protocol 2.0)</td>
      <td>
        | ssh-hostkey: <br>
        | 3072 1f:1b:af:3d:50:0f:d9:4b:c9:7e:ca:6b:d8:c1:1e:c5 (RSA)<br>
        | 256 70:24:53:87:3b:49:b0:7c:12:e9:a8:53:0e:a9:eb:05 (ECDSA)<br>
        |_256 17:fc:dc:6d:4a:f7:a5:86:89:39:d5:53:75:27:79:a0 (ED25519)
      </td>
    </tr>
    <tr>
      <td>80/tcp</td>
      <td>Open</td>
      <td>http</td>
      <td>Apache httpd 2.4.41 ((Ubuntu))</td>
      <td>
        |_http-server-header: Apache/2.4.41 (Ubuntu)<br>
        |_http-title: Apache2 Ubuntu Default Page: It works
      </td>
    </tr>
    <tr>
      <td>8080</td>
      <td>Open</td>
      <td>http-proxy</td>
      <td>Apache httpd 2.4.41 ((Ubuntu))</td>
      <td>
        _http-title: Simple Image Gallery System<br>
        |_http-server-header: Apache/2.4.41 (Ubuntu)<br>
        | http-open-proxy: Potentially OPEN proxy.<br>
        |_Methods supported: CONNECTION<br>
        | http-cookie-flags: <br>
        | /:<br>
        | PHPSESSID:<br>
        |_ httponly flag not set<br>
        Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
      </td>
    </tr>
  </tbody>
</table>

<h3>Scan 3:</h3>
<pre><code>nmap -p- 10.10.171.189</code></pre>

<table border="1" cellpadding="6" cellspacing="0">
  <thead>
    <tr>
      <th>Ports</th>
      <th>State</th>
      <th>Service</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>22/tcp</td>
      <td>Open</td>
      <td>ssh</td>
    </tr>
    <tr>
      <td>80/tcp</td>
      <td>Open</td>
      <td>http</td>
    </tr>
    <tr>
      <td>8080</td>
      <td>Open</td>
      <td>http-proxy</td>
    </tr>
  </tbody>
</table>

            <hr>
            <!-- Port 80 -->
            <h2>Exploring Port 80 (HTTP)</h2>
            <p>When we head over to the Port 80 of the target server, we land on the default Apache Page.</p>

            <hr>
            <!-- Port 8080 -->
            <h2>Exploring Port 8080 (HTTP-Proxy)</h2>
            <p>When we head over to the port 8080 of the target we are directed to the login URL: http://10.10.171.189/gallery/login.php</p>        
            <img src="../gallery/assets/Pasted image 20251119130308.png" alt="">
           <p>Simple Image Gallery is the name of the CMS.</p>

            <h3>Directory enumeration</h3>
            <p>To enumerate directories we will use <strong>FuFF</strong></p>
            <p>First, in the URL, I have requested for:</p>
            <pre><code>ffuf -u http://10.10.171.189/gallery/FUZZ \
-w /usr/share/wordlists/SecLists/Discovery/Web-Content/big.txt \
-e .php,.txt,.rsa,.conf,.bak,.env,.json,.old,.ini \
-fc 404,403</code></pre>

            <p><strong>Output:</strong></p>
            <img src="../gallery/assets/Pasted image 20251119131408.png" atl="">
            <hr>
            
            <h2>Initial Foothold</h2>
            <p>Since this is a login page, I attempted a standard SQL Injection with <strong>admin</strong> as username:</p>
            <img src="../gallery/assets/Pasted image 20251119133140.png" atl="">

            <p>And it worked:</p>
            <img src="../gallery/assets/Pasted image 20251119133203.png" atl="">

            <p>Then I found a place to upload files. Of course the file uploaded was unrestricted, so I uploaded a reverse PHP shell :</p>
            <img src="../gallery/assets/Pasted image 20251119133627.png" atl="">

            <p>And triggered it by visiting the URL.</p>
            <p>Now we have a shell access as www-data:</p>
            <img src="../gallery/assets/Pasted image 20251119133653.png" atl="">
            <img src="../gallery/assets/Pasted image 20251119133706.png" atl="">

            <p>Then, I explored the codebase of the CMS. I looked at the initialize.php and captured some new credentials and found the name of the DB we could interact with:</p>
            <img src="../gallery/assets/Pasted image 20251119134207.png" atl="">

            <p>Moving on from here, we can start interacting with the target database to harvest more information.</p>
            <p><strong>Note:</strong> Interactive mode wasn't working when I was trying to connect as the user, so I ran the queries using the -e argument.</p>

            <h3>SQL Enumeration</h3>
            <p>First we will enumerate what databases are available:</p>
            <img src="../gallery/assets/Pasted image 20251119134926.png" atl="">

            <p>After doing a bit more enumeration, I found the admin's hash password:</p>
            <img src="../gallery/assets/Pasted image 20251119135447.png" atl="">

            <hr>

            <h2>Capturing the user's flag</h2>
            <p>I located the user's flag in mike's directory, but it cannot be read or modified by www-data:</p>
            <img src="../gallery/assets/Pasted image 20251119140055.png" atl="">

            <p>However, after doing some more enumeration, I was able to find a backup of Mike's home directory. (Located in /bar/backups)</p>
            <img src="../gallery/assets/Pasted image 20251119140612.png" atl="">

            <p>Then inside of <strong>.bash_history</strong>we find his password:</p>
            <img src="../gallery/assets/Pasted image 20251119140655.png" atl="">

            <p>Then we can change user and login as mike.</p>
            <img src="../gallery/assets/Pasted image 20251119140837.png" atl="">

            <p>Then we get to read the user.txt that held the user flag:</p>
            <img src="" atl="../gallery/assets/Pasted image 20251119140855.png">

            <hr>
            <h2>Privesc</h2>
            <p>We start with some basic enumeration:</p>
            <p><strong>Identifiying what group(s) is Mike part of:</strong></p>
            <img src="../gallery/assets/Pasted image 20251119141006.png" atl="">

            <p><strong>Listing the users and commands that can be ran:</strong></p>
            <img src="../gallery/assets/Pasted image 20251119141036.png" atl="">

            <p>Let's go take a look at the root bash script: <strong>rootkit.sh</strong>:</p>
            <img src="../gallery/assets/Pasted image 20251119141443.png" atl="">

            <p>We can identify that multiple bins are being used in this script and more notably <strong>/bin/nano</strong>. Using <a href="https://gtfobins.github.io/gtfobins/nano/">GTFObins</a> we see that <strong>nano</strong> can be used to spawn a shell, and since the rootkit script will be running as root, we can obtain a root shell!</p>
            <ul>
                <li><pre><code>sudo /bin/bash /opt/rootkit.sh</code></pre></li>
                <li>Enter <strong>read</strong> when prompted to start nano.</li>
                <li>Hit <strong>Ctrl+R</strong> followed by <strong>Ctrl+X</strong> — this will allow us to enter a single command to execute and will insert the output into the current file.</li>
                <li>We don’t want that, so running <strong>reset; sh 1>&0 2>&0</strong> will open a shell for us.</li>
                <li>From there we can capture the root flag!</li>
            </ul>

            <p><strong>Answer:</strong> THM{ba87e0dfe5903adfa6b8b450ad7567bafde87}</p>
        </section>
    </main>

    <!-- Footer -->
    <footer id="footer">
        <div class="footer-container">
            <p>&copy; 2025 W4RSH3LL. All rights reserved.</p>

            <div class="footer-links">

                <!-- Email -->
                <a href="mailto:w4rsh3ll@pm.me" class="footer-link" title="Email">
                    <svg class="footer-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 
                        1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 
                        2-2zm0 2v.01L12 13l8-6.99V6H4zm0 
                        12h16V8l-8 6-8-6v10z"/>
                    </svg>
                    <span>w4rsh3ll@pm.me</span>
                </a>

                <!-- GitHub -->
                <a href="https://github.com/w4rsh3ll" target="_blank" class="footer-link" title="GitHub">
                    <svg class="footer-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 0C5.37 0 0 5.37 0 
                        12c0 5.3 3.438 9.8 8.205 
                        11.387.6.113.82-.26.82-.577v-2.256c-3.338.726-4.033-1.61-4.033-1.61-.546-1.387-1.333-1.757-1.333-1.757-1.09-.745.083-.729.083-.729 
                        1.205.085 1.84 1.236 1.84 
                        1.236 1.07 1.834 2.807 1.304 
                        3.492.997.108-.775.418-1.304.762-1.604-2.665-.304-5.466-1.332-5.466-5.93 
                        0-1.31.467-2.38 1.235-3.22-.123-.303-.535-1.523.117-3.176 
                        0 0 1.008-.322 3.301 1.23a11.52 
                        11.52 0 0 1 3.003-.404c1.02.005 
                        2.047.138 3.004.404 2.291-1.552 
                        3.297-1.23 3.297-1.23.655 1.653.243 
                        2.873.12 3.176.77.84 1.232 
                        1.91 1.232 3.22 0 4.61-2.807 
                        5.624-5.48 5.922.43.37.823 1.102.823 
                        2.222v3.293c0 .32.217.694.825.576A12.01 
                        12.01 0 0 0 24 12c0-6.63-5.37-12-12-12z"/>
                    </svg>
                    <span>github.com/w4rsh3ll</span>
                </a>

                <!-- TryHackMe -->
                <a href="https://tryhackme.com/p/W4RSH3LL" target="_blank" class="footer-link" title="TryHackMe">
                    <svg class="footer-icon" viewBox="0 0 46.069 46.069" fill="currentColor">
                        <g>…</g>
                    </svg>
                    <span>tryhackme.com/W4RSH3LL</span>
                </a>

            </div>
        </div>
    </footer>
    <script src="../../../js/script.js"></script>
</body>
</html>
